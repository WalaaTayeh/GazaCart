<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GAZACART | الفئة</title>
  <link rel="stylesheet" href="css/main.css">
  <link id="favicon" rel="icon" type="image/png" href="images/cart.svg">
  <link rel="preload" href="cart-modals.html" as="fetch" crossorigin="anonymous">

  <style>
body.client-page {
  display: flex;
  flex-direction: column;
  min-height: 100vh; 
  margin: 0;
}

   .store-track {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 بطاقات في الصف */
  gap: 20px;
}


    .store-card {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease;
    }

    .store-card:hover {
      transform: translateY(-5px);
    }

    .store-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .store-card .overlay {
      padding: 10px;
      text-align: center;
    }

    .store-card .overlay p {
      font-weight: bold;
      color: var(white);
      margin-bottom: 5px;
    }

    .store-card .overlay span {
      color: #f4b400;
    }
/* المحتوى الرئيسي يأخذ كل المساحة المتبقية */
.category-content {
  flex: 1; /* يوسع ليملأ الفراغ بين الهيدر والفوتر */
  padding: 50px 0;
}

    .category-content h1 {
      text-align: center;
      color: var(--primary-500);
      margin-bottom: 30px;
    }

    @media (max-width: 1200px) {
  .store-track {
    grid-template-columns: repeat(3, 1fr); /* 3 بطاقات في الصف على الشاشات المتوسطة */
  }
}

@media (max-width: 900px) {
  .store-track {
    grid-template-columns: repeat(2, 1fr); /* 2 بطاقات في الصف على الشاشات الصغيرة */
  }
}

@media (max-width: 600px) {
  .store-track {
    grid-template-columns: 1fr; /* بطاقة واحدة في الصف على الموبايل */
  }
}
.category-search {
  text-align: center;
  margin-bottom: 30px;
}

.category-search input {
  width: 60%;
  max-width: 400px;
  padding: 10px 15px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 1rem;
  transition: 0.3s;
}

.category-search input:focus {
  border-color: var(--primary-500);
  outline: none;
}
/* شريط تصنيف المتاجر */
.category-nav {
  text-align: center;
  margin-bottom: 20px;
  font-weight: bold;
  font-size: 1rem;
}

.category-nav span {
  margin: 0 8px;
  cursor: pointer;
  transition: 0.3s;
}

.category-nav span:hover {
  color: var(--primary-500);
}

.category-nav span.active {
  color: var(--primary-500);
}
.nav a.active {
  color: var(--primary-500);
  font-weight: bold;
  border-bottom: 2px solid var(--primary-500);
}
  </style>
</head>
<body class="client-page">
  <!-- Header -->
  <header class="header" dir="rtl">
    <div class="container">
      <a href="index.html#hero" class="logo-link">
        <img src="images/cart.svg" alt="logo" class="logo">
      </a>

      <nav class="nav">
        <a href="index.html">الرئيسية</a>
        <a href="category.html?cat=best" id="nav-best">أفضل المتاجر</a>
        <a href="category.html?cat=clothes" id="nav-clothes">متاجر الملابس</a>
        <a href="category.html?cat=accessories" id="nav-accessories">متاجر الاكسسوارات</a>
        <a href="category.html?cat=sweets" id="nav-sweets">متاجر الحلويات</a>
        <a href="#footer">اتصل بنا</a>
      </nav>

      <div class="header-left-group">
        <div class="cart">
          <img src="images/Frame 20.png" alt="سلة" onclick="openCart()">
          <span>0</span>
        </div>

        <button class="nav-toggle" aria-label="Toggle navigation">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </div>
  </header>

  <!-- محتوى الفئة -->
  <section class="category-content">
    <div class="container">
      <h1 id="category-title"></h1>
      
      <div class="category-search">
  <input type="text" id="searchInput" placeholder="ابحث عن متجر..." />
</div>

      <div id="category-stores" class="store-track"></div>
    </div>
  </section>

   <!-- Footer -->
  <footer class="footer">
    <div class="container" id="footer">
      <div class="footer-col">
        <img src="images/cart.svg" alt="footer logo" class="footer-logo">
        <p>موقع GAZA CART ، لتسهيل طلب خدماتك بسرعة ووقت...</p>
      </div>
      <div class="footer-col">
        <h4>الخدمات</h4>
        <ul>
          <li>من نحن</li>
          <li>الأسئلة الشائعة</li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>سياسة الخصوصية</h4>
        <ul>
          <li>سياسة الترجيع</li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>تابعونا على</h4>
        <div class="social">
          <img src="images/Facebook.svg" alt="فيسبوك">
          <img src="images/Instagram.svg" alt="انستغرام">
          <img src="images/Twitter.svg" alt="تويتر">
          <img src="images/TikTok.svg" alt="تيك توك">
          <img src="images/YouTube.svg" alt="يوتيوب">
        </div>
      </div>
    </div>
  </footer>

  <!-- Copyright -->
  <div class="copyright">
    <p>جميع الحقوق محفوظة ©<span id="year"></span></p>
  </div>

  <div id="modals-container"></div>
  <script>
    // تحميل المودالات من ملف خارجي
    fetch("cart-modals.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("modals-container").innerHTML = html;

        // ✅ تفعيل أكواد المودالات بعد تحميلها
        window.openCart = function () {
          document.getElementById('cartModal').style.display = 'flex';
        };

        window.onclick = function (event) {
          const modal = document.getElementById('cartModal');
          if (event.target === modal) modal.style.display = "none";
        };

        document.querySelectorAll(".cart-summary .btn").forEach(btn => {
          btn.addEventListener("click", () => {
            document.getElementById("cartModal").style.display = "none";
            document.getElementById("paymentModal").style.display = "flex";
          });
        });

        document.querySelector(".btn-cash").addEventListener("click", function () {
          document.getElementById("paymentModal").style.display = "none";
          document.getElementById("checkoutModal").style.display = "flex";
        });

        document.querySelector(".checkout-popup form").addEventListener("submit", function (e) {
          e.preventDefault();
          document.getElementById("checkoutModal").style.display = "none";
          document.getElementById("doneModal").style.display = "flex";
        });

        document.querySelector(".btn-done").addEventListener("click", function () {
          document.getElementById("doneModal").style.display = "none";
        });
      });
  </script>
  <script>
    const API_BASE = "https://gazacart.onrender.com/api";

    // عناصر الصفحة
    const urlParams = new URLSearchParams(window.location.search);
    const cat = urlParams.get('cat');
    const title = document.getElementById('category-title');
    const grid = document.getElementById('category-stores');

    const categoryNames = {
      best: "أفضل المتاجر",
      clothes: "متاجر الملابس",
      accessories: "متاجر الاكسسوارات",
      sweets: "متاجر الحلويات"
    };
    title.textContent = categoryNames[cat] || "جميع المتاجر ";
// عنصر جديد لعرض تصنيف المتاجر قبل البطاقات
const categoryNavEl = document.createElement("div");
categoryNavEl.className = "category-nav";
categoryNavEl.style.textAlign = "center";
categoryNavEl.style.marginBottom = "20px";
categoryNavEl.style.fontWeight = "bold";

// نص التصنيفات
const allCats = [
  { key: "all", label: "الكل" },
  { key: "best", label: "أفضل المتاجر" },
  { key: "clothes", label: "متاجر الملابس" },
  { key: "accessories", label: "متاجر الإكسسوارات" },
  { key: "sweets", label: "متاجر الحلويات" },
];

// إنشاء عناصر لكل تصنيف
allCats.forEach((catItem, index) => {
  const span = document.createElement("span");
  span.textContent = catItem.label;
  span.className = (catItem.key === cat || (!cat && catItem.key === "all")) ? "active" : "";
  span.addEventListener("click", () => {
    window.location.href = `category.html?cat=${catItem.key}`;
  });
  categoryNavEl.appendChild(span);
  
  if (index !== allCats.length - 1) {
    const separator = document.createElement("span");
    separator.textContent = "/";
    separator.style.margin = "0 5px";
    categoryNavEl.appendChild(separator);
  }
});

// إدراج العنصر بعد العنوان مباشرة
title.insertAdjacentElement("afterend", categoryNavEl);

    function renderStores(stores) {
      grid.innerHTML = "";
      if (!stores || stores.length === 0) {
        grid.innerHTML = "<p style='text-align:center;color:var(--black-700)'>لا توجد متاجر لعرضها.</p>";
        return;
      }
      stores.forEach(store => {
        const card = document.createElement("div");
        card.className = "store-card";
        const imageUrl =
          store.images && store.images.length > 0
            ? `${API_BASE.replace('/api','')}${store.images[0]}`
            : "images/Component 1.png";

        card.innerHTML = `
          <a href="home.html?id=${store._id}">
            <img src="${imageUrl}" alt="${store.name}">
            <div class="overlay">
              <p>${store.name}</p>
              <span>${"★".repeat(store.rating || 0)}${"☆".repeat(5 - (store.rating || 0))}</span>
            </div>
          </a>
        `;
        grid.appendChild(card);
      });
    }

    async function fetchCategoryStores(category) {
      try {
        let endpoint = '/stores';
        if (category) {
          if (category === 'best') endpoint += '/top';
         else if (category !== 'all') endpoint += `?category=${encodeURIComponent(category)}`;
        }

        const url = `${API_BASE}${endpoint}`;
        const res = await fetch(url, { method: 'GET', credentials: 'include' });
        if (!res.ok) {
          const text = await res.text().catch(()=>null);
          grid.innerHTML = `<p style="text-align:center;color:var(--error-bg)">حدث خطأ: ${res.status} ${res.statusText}</p>`;
          return;
        }

        const stores = await res.json();
        renderStores(stores);
        window.__allCategoryStores = stores;
      } catch (err) {
        grid.innerHTML = `<p style="text-align:center;color:var(--black-700)">حدث خطأ أثناء جلب المتاجر.</p>`;
      }
    }

    fetchCategoryStores(cat);

    // السنة التلقائية
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();
  </script>
  <script>
   

    document.addEventListener('DOMContentLoaded', function() {
        const navToggle = document.querySelector('.nav-toggle');
        const navMenu = document.querySelector('.nav');

        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('open');
        });
    });
    const searchInput = document.getElementById("searchInput");

searchInput.addEventListener("input", function() {
  const query = this.value.toLowerCase();
  const filteredStores = (window.__allCategoryStores || []).filter(store =>
    store.name.toLowerCase().includes(query)
  );
  renderStores(filteredStores);
});

  </script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const cat = params.get("cat");

  // تحديد روابط الهيدر
  const navLinks = {
    best: document.getElementById("nav-best"),
    clothes: document.getElementById("nav-clothes"),
    accessories: document.getElementById("nav-accessories"),
    sweets: document.getElementById("nav-sweets")
  };

  // إزالة أي كلاس active سابق
  Object.values(navLinks).forEach(link => link && link.classList.remove("active"));

  // تفعيل الرابط المناسب
  if (cat && navLinks[cat]) {
    navLinks[cat].classList.add("active");
  } else {
     navLinks.all.classList.add("active");
  }
});
</script>

   <script src="js/stores.js"></script>
  <script src="js/cart-script.js"></script>
</body>
</html>
